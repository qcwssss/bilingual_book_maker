
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.20">
    
    
      
        <title>EPUB Translation Service API Documentation - bilingual book maker</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.e53b48f4.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#epub-translation-service-api-documentation" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="bilingual book maker" class="md-header__button md-logo" aria-label="bilingual book maker" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            bilingual book maker
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              EPUB Translation Service API Documentation
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../installation/" class="md-tabs__link">
          
  
  
  Getting started

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../model_lang/" class="md-tabs__link">
          
  
  
  Usage

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../disclaimer/" class="md-tabs__link">
        
  
  
    
  
  Disclaimer

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="bilingual book maker" class="md-nav__button md-logo" aria-label="bilingual book maker" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    bilingual book maker
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Getting started
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Getting started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../quickstart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    QuickStart
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Usage
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Usage
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../model_lang/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Model and languages
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cmd/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Command line options
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../book_source/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Translate from different source
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../env_settings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Environment setting
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../prompt/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tweak the prompt
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../disclaimer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Disclaimer
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#architecture-overview" class="md-nav__link">
    <span class="md-ellipsis">
      Architecture Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#base-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Base Configuration
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#environment-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Environment Configuration
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#authentication" class="md-nav__link">
    <span class="md-ellipsis">
      Authentication
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#core-api-endpoints" class="md-nav__link">
    <span class="md-ellipsis">
      Core API Endpoints
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Core API Endpoints">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-post-translate" class="md-nav__link">
    <span class="md-ellipsis">
      1. POST /translate
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. POST /translate">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#request" class="md-nav__link">
    <span class="md-ellipsis">
      Request
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#response" class="md-nav__link">
    <span class="md-ellipsis">
      Response
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#todo-local-development-mode-response-is-incorrect-we-shouldnt-return-the-file-in-binary-because-when-it-succeed-the-files-will-be-saved-in-some-local-directory-im-thinking-maybe-its-better-we-return-a-job-id-and-make-the-translate-async" class="md-nav__link">
    <span class="md-ellipsis">
      TODO: Local development mode response is incorrect, we shouldn't return the file in binary, because when it succeed, the files will be saved in some local directory. I'm thinking maybe it's better we return a job id and make the translate async.
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TODO: Local development mode response is incorrect, we shouldn&#39;t return the file in binary, because when it succeed, the files will be saved in some local directory. I&#39;m thinking maybe it&#39;s better we return a job id and make the translate async.">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#error-responses" class="md-nav__link">
    <span class="md-ellipsis">
      Error Responses
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-get-models" class="md-nav__link">
    <span class="md-ellipsis">
      2. GET /models
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. GET /models">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#request_1" class="md-nav__link">
    <span class="md-ellipsis">
      Request
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#response_1" class="md-nav__link">
    <span class="md-ellipsis">
      Response
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-get-languages" class="md-nav__link">
    <span class="md-ellipsis">
      3. GET /languages
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. GET /languages">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#request_2" class="md-nav__link">
    <span class="md-ellipsis">
      Request
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#response_2" class="md-nav__link">
    <span class="md-ellipsis">
      Response
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-get-downloadjob_id" class="md-nav__link">
    <span class="md-ellipsis">
      4. GET /download/{job_id}
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. GET /download/{job_id}">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#request_3" class="md-nav__link">
    <span class="md-ellipsis">
      Request
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#response_3" class="md-nav__link">
    <span class="md-ellipsis">
      Response
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-get-health" class="md-nav__link">
    <span class="md-ellipsis">
      5. GET /health
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5. GET /health">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#request_4" class="md-nav__link">
    <span class="md-ellipsis">
      Request
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#response_4" class="md-nav__link">
    <span class="md-ellipsis">
      Response
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#error-handling" class="md-nav__link">
    <span class="md-ellipsis">
      Error Handling
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Error Handling">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#error-response-format" class="md-nav__link">
    <span class="md-ellipsis">
      Error Response Format
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#common-error-types" class="md-nav__link">
    <span class="md-ellipsis">
      Common Error Types
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#retry-logic" class="md-nav__link">
    <span class="md-ellipsis">
      Retry Logic
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration-options" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration Options
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configuration Options">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#environment-variables" class="md-nav__link">
    <span class="md-ellipsis">
      Environment Variables
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Environment Variables">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#required" class="md-nav__link">
    <span class="md-ellipsis">
      Required
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aws-s3-configuration-when-storage_modes3" class="md-nav__link">
    <span class="md-ellipsis">
      AWS S3 Configuration (when STORAGE_MODE=s3)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optional-api-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Optional API Configuration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#file-size-limits" class="md-nav__link">
    <span class="md-ellipsis">
      File Size Limits
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deployment-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      Deployment Considerations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Deployment Considerations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#local-development" class="md-nav__link">
    <span class="md-ellipsis">
      Local Development
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#production-deployment" class="md-nav__link">
    <span class="md-ellipsis">
      Production Deployment
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Production Deployment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aws-ecsfargate" class="md-nav__link">
    <span class="md-ellipsis">
      AWS ECS/Fargate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#iam-permissions" class="md-nav__link">
    <span class="md-ellipsis">
      IAM Permissions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#load-balancer-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Load Balancer Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#monitoring-observability" class="md-nav__link">
    <span class="md-ellipsis">
      Monitoring &amp; Observability
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Monitoring &amp; Observability">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cloudwatch-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      CloudWatch Metrics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#log-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Log Structure
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rate-limiting-performance" class="md-nav__link">
    <span class="md-ellipsis">
      Rate Limiting &amp; Performance
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Rate Limiting &amp; Performance">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#recommended-limits" class="md-nav__link">
    <span class="md-ellipsis">
      Recommended Limits
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#performance-characteristics" class="md-nav__link">
    <span class="md-ellipsis">
      Performance Characteristics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scaling-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      Scaling Considerations
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#security-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      Security Considerations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Security Considerations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#input-validation" class="md-nav__link">
    <span class="md-ellipsis">
      Input Validation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#api-key-handling" class="md-nav__link">
    <span class="md-ellipsis">
      API Key Handling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#file-handling" class="md-nav__link">
    <span class="md-ellipsis">
      File Handling
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#client-integration-examples" class="md-nav__link">
    <span class="md-ellipsis">
      Client Integration Examples
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Client Integration Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#javascripttypescript" class="md-nav__link">
    <span class="md-ellipsis">
      JavaScript/TypeScript
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#python" class="md-nav__link">
    <span class="md-ellipsis">
      Python
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#curl-examples" class="md-nav__link">
    <span class="md-ellipsis">
      cURL Examples
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="epub-translation-service-api-documentation">EPUB Translation Service API Documentation</h1>
<h2 id="overview">Overview</h2>
<p>The EPUB Translation Service is a FastAPI-based web service that wraps the <code>bilingual_book_maker</code> CLI tool to provide RESTful translation capabilities for EPUB files. The service supports both local development and production deployment with AWS S3 integration.</p>
<h2 id="architecture-overview">Architecture Overview</h2>
<pre><code class="language-mermaid">graph TB
    subgraph &quot;Client Applications&quot;
        FE[Frontend App]
        CLI[CLI Tools]
        API[Third-party APIs]
    end

    subgraph &quot;FastAPI Service&quot;
        Router[API Router]
        Validator[Request Validator]
        Processor[Translation Processor]
        Storage[Storage Handler]
    end

    subgraph &quot;Translation Engine&quot;
        BBM[bilingual_book_maker]
        Models[Translation Models]
    end

    subgraph &quot;Storage Layer&quot;
        Local[Local FileSystem]
        S3[AWS S3]
    end

    FE --&gt; Router
    CLI --&gt; Router
    API --&gt; Router

    Router --&gt; Validator
    Validator --&gt; Processor
    Processor --&gt; Storage
    Processor --&gt; BBM
    BBM --&gt; Models

    Storage --&gt; Local
    Storage --&gt; S3
</code></pre>
<h2 id="base-configuration">Base Configuration</h2>
<p><strong>Base URL</strong>:
- Local Development: <code>http://localhost:8000</code>
- Production: <code>https://your-domain.com</code></p>
<p><strong>API Version</strong>: <code>v1</code></p>
<h2 id="environment-configuration">Environment Configuration</h2>
<p>The service behavior adapts based on the <code>STORAGE_MODE</code> environment variable:</p>
<ul>
<li><code>STORAGE_MODE=local</code>: Local filesystem storage</li>
<li><code>STORAGE_MODE=s3</code>: AWS S3 storage for production</li>
</ul>
<h2 id="authentication">Authentication</h2>
<p>Currently, the API does not implement authentication. In production, consider adding:
- API key authentication
- JWT token validation
- Rate limiting per client</p>
<h2 id="core-api-endpoints">Core API Endpoints</h2>
<h3 id="1-post-translate">1. POST /translate</h3>
<p>Uploads and translates an EPUB file. Behavior varies by environment.</p>
<h4 id="request">Request</h4>
<p><strong>Endpoint</strong>: <code>POST /translate</code></p>
<p><strong>Content-Type</strong>: <code>multipart/form-data</code></p>
<p><strong>Parameters</strong>:</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>file</code></td>
<td>File</td>
<td>Yes</td>
<td>EPUB file to translate</td>
<td>-</td>
</tr>
<tr>
<td><code>target_language</code></td>
<td>String</td>
<td>Yes</td>
<td>Target language code</td>
<td>-</td>
</tr>
<tr>
<td><code>model</code></td>
<td>String</td>
<td>Yes</td>
<td>Translation model to use</td>
<td>-</td>
</tr>
<tr>
<td><code>openai_key</code></td>
<td>String</td>
<td>Conditional</td>
<td>OpenAI API key (if using OpenAI models)</td>
<td>-</td>
</tr>
<tr>
<td><code>claude_key</code></td>
<td>String</td>
<td>Conditional</td>
<td>Claude API key (if using Claude models)</td>
<td>-</td>
</tr>
<tr>
<td><code>gemini_key</code></td>
<td>String</td>
<td>Conditional</td>
<td>Gemini API key (if using Gemini models)</td>
<td>-</td>
</tr>
<tr>
<td><code>groq_key</code></td>
<td>String</td>
<td>Conditional</td>
<td>Groq API key (if using Groq models)</td>
<td>-</td>
</tr>
<tr>
<td><code>xai_key</code></td>
<td>String</td>
<td>Conditional</td>
<td>xAI API key (if using xAI models)</td>
<td>-</td>
</tr>
<tr>
<td><code>qwen_key</code></td>
<td>String</td>
<td>Conditional</td>
<td>Qwen API key (if using Qwen models)</td>
<td>-</td>
</tr>
<tr>
<td><code>caiyun_key</code></td>
<td>String</td>
<td>Conditional</td>
<td>Caiyun API key (if using Caiyun)</td>
<td>-</td>
</tr>
<tr>
<td><code>deepl_key</code></td>
<td>String</td>
<td>Conditional</td>
<td>DeepL API key (if using DeepL)</td>
<td>-</td>
</tr>
<tr>
<td><code>custom_api</code></td>
<td>String</td>
<td>Conditional</td>
<td>Custom API endpoint (if using custom model)</td>
<td>-</td>
</tr>
<tr>
<td><code>temperature</code></td>
<td>Float</td>
<td>No</td>
<td>Model temperature (0.0-2.0)</td>
<td>1.0</td>
</tr>
<tr>
<td><code>test</code></td>
<td>Boolean</td>
<td>No</td>
<td>Test mode (translate only first 10 paragraphs)</td>
<td>false</td>
</tr>
<tr>
<td><code>test_num</code></td>
<td>Integer</td>
<td>No</td>
<td>Number of paragraphs for testing</td>
<td>10</td>
</tr>
<tr>
<td><code>single_translate</code></td>
<td>Boolean</td>
<td>No</td>
<td>Output only translated text (no bilingual)</td>
<td>false</td>
</tr>
<tr>
<td><code>proxy</code></td>
<td>String</td>
<td>No</td>
<td>HTTP proxy URL</td>
<td>-</td>
</tr>
<tr>
<td><code>api_base</code></td>
<td>String</td>
<td>No</td>
<td>Custom API base URL</td>
<td>-</td>
</tr>
<tr>
<td><code>batch_size</code></td>
<td>Integer</td>
<td>No</td>
<td>Lines per translation batch</td>
<td>-</td>
</tr>
<tr>
<td><code>temperature</code></td>
<td>Float</td>
<td>No</td>
<td>Model creativity (0.0-2.0)</td>
<td>1.0</td>
</tr>
<tr>
<td><code>source_lang</code></td>
<td>String</td>
<td>No</td>
<td>Source language (auto-detect if not specified)</td>
<td>"auto"</td>
</tr>
</tbody>
</table>
<h4 id="response">Response</h4>
<h2 id="todo-local-development-mode-response-is-incorrect-we-shouldnt-return-the-file-in-binary-because-when-it-succeed-the-files-will-be-saved-in-some-local-directory-im-thinking-maybe-its-better-we-return-a-job-id-and-make-the-translate-async">TODO: Local development mode response is incorrect, we shouldn't return the file in binary, because when it succeed, the files will be saved in some local directory. I'm thinking maybe it's better we return a job id and make the translate async.</h2>
<p>I also not sure how sync process should work in prod, we need to discuss this. I think it's better the post api should return 200 if the translate request is successfully received and started. As for how to track the progress and download the completed translation, let's discuss this.</p>
<p>GPT suggest：
现在这是一个基于 FastAPI 的翻译服务项目（是从 bilingual_book_maker 修改来的）。
请你先帮我确认现有代码是否有以下能力：</p>
<p>翻译逻辑：</p>
<p>目前的翻译核心代码是不是一次性翻译整本 ePub，而不是分片翻译？</p>
<p>有没有办法在翻译过程中逐步返回进度（比如 20%、50%、80%），还是只能在完成后一次性输出？</p>
<p>API 层：</p>
<p>现有的 POST /translate 是不是阻塞式执行？- 我确认过，是本地sync执行的，没有异步化。</p>
<p>项目里有没有 GET /status/{job_id} 这样的接口？- 应该是没有的</p>
<p>如果我现在加一个 GET /status/{job_id}，它能不能正确返回任务的状态？还是目前代码结构里没有合适的任务状态管理机制？</p>
<p>状态管理：</p>
<p>项目里有没有地方维护任务状态（比如 pending/running/done/failed）？</p>
<p>如果没有，是否需要新增一个任务字典（或存储）来支持 GET /status/{job_id} 查询？</p>
<p>请你不要直接修改代码，先确认以上几点，告诉我现在的代码处于什么状态，哪些地方已经支持，哪些地方还需要改造。</p>
<p><strong>Local Development Mode</strong>:</p>
<pre><code class="language-http">HTTP/1.1 200 OK
Content-Type: application/epub+zip
Content-Disposition: attachment; filename=&quot;translated_book.epub&quot;

[Binary EPUB file data]
</code></pre>
<p><strong>Production Mode (S3)</strong>:</p>
<pre><code class="language-json">{
  &quot;status&quot;: &quot;success&quot;,
  &quot;job_id&quot;: &quot;uuid-4-format-job-id&quot;,
  &quot;download_url&quot;: &quot;https://your-bucket.s3.amazonaws.com/downloads/translated_book.epub?signed-params&quot;,
  &quot;filename&quot;: &quot;original_filename_translated.epub&quot;,
  &quot;expiry&quot;: &quot;2024-01-15T12:00:00Z&quot;,
  &quot;message&quot;: &quot;Translation completed successfully&quot;
}
</code></pre>
<h4 id="error-responses">Error Responses</h4>
<pre><code class="language-json">{
  &quot;error&quot;: &quot;validation_error&quot;,
  &quot;message&quot;: &quot;Missing required API key for model 'chatgptapi'&quot;,
  &quot;details&quot;: {
    &quot;field&quot;: &quot;openai_key&quot;,
    &quot;required_for_models&quot;: [&quot;chatgptapi&quot;, &quot;gpt4&quot;, &quot;gpt4omini&quot;, &quot;gpt4o&quot;]
  }
}
</code></pre>
<pre><code class="language-json">{
  &quot;error&quot;: &quot;translation_error&quot;,
  &quot;message&quot;: &quot;Translation failed due to API rate limit&quot;,
  &quot;details&quot;: {
    &quot;provider&quot;: &quot;openai&quot;,
    &quot;error_code&quot;: &quot;rate_limit_exceeded&quot;,
    &quot;retry_after&quot;: 60
  }
}
</code></pre>
<pre><code class="language-json">{
  &quot;error&quot;: &quot;file_error&quot;,
  &quot;message&quot;: &quot;Invalid EPUB file format&quot;,
  &quot;details&quot;: {
    &quot;file_type_detected&quot;: &quot;application/pdf&quot;,
    &quot;expected&quot;: &quot;application/epub+zip&quot;
  }
}
</code></pre>
<hr />
<h3 id="2-get-models">2. GET /models</h3>
<p>Returns list of available translation models with metadata.</p>
<h4 id="request_1">Request</h4>
<p><strong>Endpoint</strong>: <code>GET /models</code></p>
<h4 id="response_1">Response</h4>
<pre><code class="language-json">{
  &quot;models&quot;: [
    {
      &quot;id&quot;: &quot;chatgptapi&quot;,
      &quot;name&quot;: &quot;GPT-3.5 Turbo&quot;,
      &quot;provider&quot;: &quot;openai&quot;,
      &quot;requires_api_key&quot;: true,
      &quot;api_key_field&quot;: &quot;openai_key&quot;,
      &quot;pricing&quot;: &quot;paid&quot;,
      &quot;description&quot;: &quot;OpenAI's GPT-3.5 Turbo model&quot;,
      &quot;supports_batch&quot;: true
    },
    {
      &quot;id&quot;: &quot;gpt4&quot;,
      &quot;name&quot;: &quot;GPT-4&quot;,
      &quot;provider&quot;: &quot;openai&quot;,
      &quot;requires_api_key&quot;: true,
      &quot;api_key_field&quot;: &quot;openai_key&quot;,
      &quot;pricing&quot;: &quot;paid&quot;,
      &quot;description&quot;: &quot;OpenAI's GPT-4 model&quot;
    },
    {
      &quot;id&quot;: &quot;claude&quot;,
      &quot;name&quot;: &quot;Claude 3&quot;,
      &quot;provider&quot;: &quot;anthropic&quot;,
      &quot;requires_api_key&quot;: true,
      &quot;api_key_field&quot;: &quot;claude_key&quot;,
      &quot;pricing&quot;: &quot;paid&quot;,
      &quot;description&quot;: &quot;Anthropic's Claude 3 model&quot;
    },
    {
      &quot;id&quot;: &quot;gemini&quot;,
      &quot;name&quot;: &quot;Google Gemini&quot;,
      &quot;provider&quot;: &quot;google&quot;,
      &quot;requires_api_key&quot;: true,
      &quot;api_key_field&quot;: &quot;gemini_key&quot;,
      &quot;pricing&quot;: &quot;freemium&quot;,
      &quot;description&quot;: &quot;Google's Gemini model&quot;
    },
    {
      &quot;id&quot;: &quot;groq&quot;,
      &quot;name&quot;: &quot;Groq&quot;,
      &quot;provider&quot;: &quot;groq&quot;,
      &quot;requires_api_key&quot;: true,
      &quot;api_key_field&quot;: &quot;groq_key&quot;,
      &quot;pricing&quot;: &quot;freemium&quot;,
      &quot;description&quot;: &quot;Groq's fast inference models&quot;
    },
    {
      &quot;id&quot;: &quot;google&quot;,
      &quot;name&quot;: &quot;Google Translate&quot;,
      &quot;provider&quot;: &quot;google&quot;,
      &quot;requires_api_key&quot;: false,
      &quot;pricing&quot;: &quot;free&quot;,
      &quot;description&quot;: &quot;Google Translate (free)&quot;
    },
    {
      &quot;id&quot;: &quot;deepl_free&quot;,
      &quot;name&quot;: &quot;DeepL Free&quot;,
      &quot;provider&quot;: &quot;deepl&quot;,
      &quot;requires_api_key&quot;: false,
      &quot;pricing&quot;: &quot;free&quot;,
      &quot;description&quot;: &quot;DeepL free translation service&quot;
    }
  ]
}
</code></pre>
<hr />
<h3 id="3-get-languages">3. GET /languages</h3>
<p>Returns list of supported target languages.</p>
<h4 id="request_2">Request</h4>
<p><strong>Endpoint</strong>: <code>GET /languages</code></p>
<h4 id="response_2">Response</h4>
<pre><code class="language-json">{
  &quot;languages&quot;: [
    {
      &quot;code&quot;: &quot;zh-hans&quot;,
      &quot;name&quot;: &quot;Chinese (Simplified)&quot;,
      &quot;native_name&quot;: &quot;简体中文&quot;
    },
    {
      &quot;code&quot;: &quot;zh-hant&quot;,
      &quot;name&quot;: &quot;Chinese (Traditional)&quot;,
      &quot;native_name&quot;: &quot;繁體中文&quot;
    },
    {
      &quot;code&quot;: &quot;en&quot;,
      &quot;name&quot;: &quot;English&quot;,
      &quot;native_name&quot;: &quot;English&quot;
    },
    {
      &quot;code&quot;: &quot;es&quot;,
      &quot;name&quot;: &quot;Spanish&quot;,
      &quot;native_name&quot;: &quot;Español&quot;
    },
    {
      &quot;code&quot;: &quot;fr&quot;,
      &quot;name&quot;: &quot;French&quot;,
      &quot;native_name&quot;: &quot;Français&quot;
    },
    {
      &quot;code&quot;: &quot;de&quot;,
      &quot;name&quot;: &quot;German&quot;,
      &quot;native_name&quot;: &quot;Deutsch&quot;
    },
    {
      &quot;code&quot;: &quot;ja&quot;,
      &quot;name&quot;: &quot;Japanese&quot;,
      &quot;native_name&quot;: &quot;日本語&quot;
    },
    {
      &quot;code&quot;: &quot;ko&quot;,
      &quot;name&quot;: &quot;Korean&quot;,
      &quot;native_name&quot;: &quot;한국어&quot;
    },
    {
      &quot;code&quot;: &quot;ru&quot;,
      &quot;name&quot;: &quot;Russian&quot;,
      &quot;native_name&quot;: &quot;Русский&quot;
    },
    {
      &quot;code&quot;: &quot;pt&quot;,
      &quot;name&quot;: &quot;Portuguese&quot;,
      &quot;native_name&quot;: &quot;Português&quot;
    },
    {
      &quot;code&quot;: &quot;it&quot;,
      &quot;name&quot;: &quot;Italian&quot;,
      &quot;native_name&quot;: &quot;Italiano&quot;
    }
  ]
}
</code></pre>
<hr />
<h3 id="4-get-downloadjob_id">4. GET /download/{job_id}</h3>
<p><strong>S3 Mode Only</strong>: Downloads translated file by job ID.</p>
<h4 id="request_3">Request</h4>
<p><strong>Endpoint</strong>: <code>GET /download/{job_id}</code></p>
<p><strong>Path Parameters</strong>:
- <code>job_id</code> (string): Unique job identifier returned from translation request</p>
<h4 id="response_3">Response</h4>
<p><strong>Success (Direct Download)</strong>:</p>
<pre><code class="language-http">HTTP/1.1 200 OK
Content-Type: application/epub+zip
Content-Disposition: attachment; filename=&quot;translated_book.epub&quot;

[Binary EPUB file data]
</code></pre>
<p><strong>Success (S3 Redirect)</strong>:</p>
<pre><code class="language-http">HTTP/1.1 302 Found
Location: https://your-bucket.s3.amazonaws.com/downloads/job-id/translated_book.epub?signed-params
</code></pre>
<p><strong>Not Found</strong>:</p>
<pre><code class="language-json">{
  &quot;error&quot;: &quot;not_found&quot;,
  &quot;message&quot;: &quot;Job ID not found or file has expired&quot;,
  &quot;job_id&quot;: &quot;requested-job-id&quot;
}
</code></pre>
<hr />
<h3 id="5-get-health">5. GET /health</h3>
<p>Service health check and configuration information.</p>
<h4 id="request_4">Request</h4>
<p><strong>Endpoint</strong>: <code>GET /health</code></p>
<h4 id="response_4">Response</h4>
<pre><code class="language-json">{
  &quot;status&quot;: &quot;healthy&quot;,
  &quot;timestamp&quot;: &quot;2024-01-15T10:30:00Z&quot;,
  &quot;version&quot;: &quot;1.0.0&quot;,
  &quot;environment&quot;: &quot;production&quot;,
  &quot;storage_mode&quot;: &quot;s3&quot;,
  &quot;configuration&quot;: {
    &quot;max_file_size_mb&quot;: 100,
    &quot;supported_formats&quot;: [&quot;epub&quot;],
    &quot;available_models&quot;: 12,
    &quot;supported_languages&quot;: 50
  },
  &quot;dependencies&quot;: {
    &quot;bilingual_book_maker&quot;: &quot;1.5.0&quot;,
    &quot;fastapi&quot;: &quot;0.104.1&quot;,
    &quot;boto3&quot;: &quot;1.29.0&quot;
  }
}
</code></pre>
<h2 id="error-handling">Error Handling</h2>
<h3 id="error-response-format">Error Response Format</h3>
<p>All errors follow a consistent format:</p>
<pre><code class="language-json">{
  &quot;error&quot;: &quot;error_type&quot;,
  &quot;message&quot;: &quot;Human-readable error message&quot;,
  &quot;details&quot;: {
    &quot;additional&quot;: &quot;context-specific information&quot;
  },
  &quot;timestamp&quot;: &quot;2024-01-15T10:30:00Z&quot;,
  &quot;request_id&quot;: &quot;uuid-for-debugging&quot;
}
</code></pre>
<h3 id="common-error-types">Common Error Types</h3>
<table>
<thead>
<tr>
<th>Error Type</th>
<th>HTTP Status</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>validation_error</code></td>
<td>400</td>
<td>Invalid request parameters</td>
</tr>
<tr>
<td><code>file_error</code></td>
<td>400</td>
<td>Invalid or corrupted file</td>
</tr>
<tr>
<td><code>authentication_error</code></td>
<td>401</td>
<td>Missing or invalid API keys</td>
</tr>
<tr>
<td><code>translation_error</code></td>
<td>422</td>
<td>Translation service failure</td>
</tr>
<tr>
<td><code>storage_error</code></td>
<td>500</td>
<td>File storage/retrieval failure</td>
</tr>
<tr>
<td><code>rate_limit_error</code></td>
<td>429</td>
<td>Too many requests</td>
</tr>
<tr>
<td><code>internal_error</code></td>
<td>500</td>
<td>Unexpected server error</td>
</tr>
</tbody>
</table>
<h3 id="retry-logic">Retry Logic</h3>
<p>For transient errors (rate limits, temporary API failures):</p>
<ol>
<li><strong>Rate Limit Errors</strong>: Check <code>retry_after</code> header/field</li>
<li><strong>API Timeouts</strong>: Exponential backoff: 1s, 2s, 4s, 8s</li>
<li><strong>Storage Errors</strong>: Linear retry: 1s, 2s, 3s</li>
</ol>
<h2 id="configuration-options">Configuration Options</h2>
<h3 id="environment-variables">Environment Variables</h3>
<h4 id="required">Required</h4>
<ul>
<li><code>STORAGE_MODE</code>: <code>local</code> or <code>s3</code></li>
</ul>
<h4 id="aws-s3-configuration-when-storage_modes3">AWS S3 Configuration (when STORAGE_MODE=s3)</h4>
<ul>
<li><code>AWS_ACCESS_KEY_ID</code>: AWS access key</li>
<li><code>AWS_SECRET_ACCESS_KEY</code>: AWS secret key</li>
<li><code>AWS_REGION</code>: AWS region (e.g., <code>us-east-1</code>)</li>
<li><code>S3_BUCKET_NAME</code>: S3 bucket for file storage</li>
<li><code>S3_PRESIGNED_URL_EXPIRY</code>: URL expiry in seconds (default: 3600)</li>
</ul>
<h4 id="optional-api-configuration">Optional API Configuration</h4>
<ul>
<li><code>MAX_FILE_SIZE_MB</code>: Maximum upload size in MB (default: 100)</li>
<li><code>TRANSLATION_TIMEOUT</code>: Translation timeout in seconds (default: 300)</li>
<li><code>TEMP_DIR</code>: Temporary file directory (default: <code>/tmp</code>)</li>
<li><code>LOG_LEVEL</code>: Logging level (default: <code>INFO</code>)</li>
</ul>
<h3 id="file-size-limits">File Size Limits</h3>
<ul>
<li><strong>Maximum file size</strong>: 100MB (configurable)</li>
<li><strong>Supported formats</strong>: <code>.epub</code> only</li>
<li><strong>Processing timeout</strong>: 300 seconds (configurable)</li>
</ul>
<h2 id="deployment-considerations">Deployment Considerations</h2>
<h3 id="local-development">Local Development</h3>
<p><strong>docker-compose.yml</strong>:</p>
<pre><code class="language-yaml">version: '3.8'
services:
  epub-translator:
    build: .
    ports:
      - &quot;8000:8000&quot;
    environment:
      - STORAGE_MODE=local
      - MAX_FILE_SIZE_MB=50
      - LOG_LEVEL=DEBUG
    volumes:
      - ./temp:/tmp
      - ./downloads:/app/downloads
</code></pre>
<h3 id="production-deployment">Production Deployment</h3>
<h4 id="aws-ecsfargate">AWS ECS/Fargate</h4>
<p><strong>Task Definition</strong>:</p>
<pre><code class="language-json">{
  &quot;family&quot;: &quot;epub-translator&quot;,
  &quot;networkMode&quot;: &quot;awsvpc&quot;,
  &quot;requiresCompatibilities&quot;: [&quot;FARGATE&quot;],
  &quot;cpu&quot;: &quot;1024&quot;,
  &quot;memory&quot;: &quot;2048&quot;,
  &quot;containerDefinitions&quot;: [
    {
      &quot;name&quot;: &quot;epub-translator&quot;,
      &quot;image&quot;: &quot;your-account.dkr.ecr.region.amazonaws.com/epub-translator:latest&quot;,
      &quot;portMappings&quot;: [
        {
          &quot;containerPort&quot;: 8000,
          &quot;protocol&quot;: &quot;tcp&quot;
        }
      ],
      &quot;environment&quot;: [
        {&quot;name&quot;: &quot;STORAGE_MODE&quot;, &quot;value&quot;: &quot;s3&quot;},
        {&quot;name&quot;: &quot;AWS_REGION&quot;, &quot;value&quot;: &quot;us-east-1&quot;},
        {&quot;name&quot;: &quot;S3_BUCKET_NAME&quot;, &quot;value&quot;: &quot;your-epub-storage-bucket&quot;},
        {&quot;name&quot;: &quot;MAX_FILE_SIZE_MB&quot;, &quot;value&quot;: &quot;100&quot;}
      ],
      &quot;logConfiguration&quot;: {
        &quot;logDriver&quot;: &quot;awslogs&quot;,
        &quot;options&quot;: {
          &quot;awslogs-group&quot;: &quot;/ecs/epub-translator&quot;,
          &quot;awslogs-region&quot;: &quot;us-east-1&quot;,
          &quot;awslogs-stream-prefix&quot;: &quot;ecs&quot;
        }
      }
    }
  ]
}
</code></pre>
<h4 id="iam-permissions">IAM Permissions</h4>
<p><strong>S3 Policy</strong>:</p>
<pre><code class="language-json">{
  &quot;Version&quot;: &quot;2012-10-17&quot;,
  &quot;Statement&quot;: [
    {
      &quot;Effect&quot;: &quot;Allow&quot;,
      &quot;Action&quot;: [
        &quot;s3:GetObject&quot;,
        &quot;s3:PutObject&quot;,
        &quot;s3:DeleteObject&quot;
      ],
      &quot;Resource&quot;: &quot;arn:aws:s3:::your-epub-storage-bucket/*&quot;
    },
    {
      &quot;Effect&quot;: &quot;Allow&quot;,
      &quot;Action&quot;: [
        &quot;s3:ListBucket&quot;
      ],
      &quot;Resource&quot;: &quot;arn:aws:s3:::your-epub-storage-bucket&quot;
    }
  ]
}
</code></pre>
<h3 id="load-balancer-configuration">Load Balancer Configuration</h3>
<p><strong>Application Load Balancer (ALB)</strong>:
- <strong>Health check path</strong>: <code>/health</code>
- <strong>Health check interval</strong>: 30 seconds
- <strong>Healthy threshold</strong>: 2
- <strong>Unhealthy threshold</strong>: 3
- <strong>Timeout</strong>: 5 seconds</p>
<h3 id="monitoring-observability">Monitoring &amp; Observability</h3>
<h4 id="cloudwatch-metrics">CloudWatch Metrics</h4>
<ul>
<li>Request count per endpoint</li>
<li>Average response time</li>
<li>Error rate by error type</li>
<li>File processing duration</li>
<li>S3 upload/download latency</li>
</ul>
<h4 id="log-structure">Log Structure</h4>
<pre><code class="language-json">{
  &quot;timestamp&quot;: &quot;2024-01-15T10:30:00Z&quot;,
  &quot;level&quot;: &quot;INFO&quot;,
  &quot;message&quot;: &quot;Translation completed&quot;,
  &quot;request_id&quot;: &quot;uuid&quot;,
  &quot;file_name&quot;: &quot;book.epub&quot;,
  &quot;model&quot;: &quot;chatgptapi&quot;,
  &quot;language&quot;: &quot;zh-hans&quot;,
  &quot;duration_seconds&quot;: 45.2,
  &quot;file_size_mb&quot;: 2.5
}
</code></pre>
<h2 id="rate-limiting-performance">Rate Limiting &amp; Performance</h2>
<h3 id="recommended-limits">Recommended Limits</h3>
<ul>
<li><strong>Requests per minute per IP</strong>: 10</li>
<li><strong>Concurrent translations</strong>: 5</li>
<li><strong>File uploads per hour</strong>: 50</li>
</ul>
<h3 id="performance-characteristics">Performance Characteristics</h3>
<ul>
<li><strong>Small EPUB (&lt; 1MB)</strong>: 30-60 seconds</li>
<li><strong>Medium EPUB (1-5MB)</strong>: 1-3 minutes</li>
<li><strong>Large EPUB (5-20MB)</strong>: 3-10 minutes</li>
</ul>
<h3 id="scaling-considerations">Scaling Considerations</h3>
<ul>
<li><strong>CPU-bound</strong>: Translation processing</li>
<li><strong>Memory usage</strong>: ~500MB per active translation</li>
<li><strong>I/O patterns</strong>: Burst read/write during file processing</li>
<li><strong>Network</strong>: API calls to translation services</li>
</ul>
<h2 id="security-considerations">Security Considerations</h2>
<h3 id="input-validation">Input Validation</h3>
<ul>
<li>File type verification (magic number checking)</li>
<li>File size limits</li>
<li>EPUB structure validation</li>
<li>Parameter sanitization</li>
</ul>
<h3 id="api-key-handling">API Key Handling</h3>
<ul>
<li>Never log API keys</li>
<li>Validate key format before use</li>
<li>Rotate keys regularly</li>
<li>Use environment variables only</li>
</ul>
<h3 id="file-handling">File Handling</h3>
<ul>
<li>Sandboxed processing directory</li>
<li>Automatic cleanup of temporary files</li>
<li>Virus scanning (recommended for production)</li>
<li>Content filtering for sensitive material</li>
</ul>
<h2 id="client-integration-examples">Client Integration Examples</h2>
<h3 id="javascripttypescript">JavaScript/TypeScript</h3>
<pre><code class="language-typescript">interface TranslationRequest {
  file: File;
  target_language: string;
  model: string;
  openai_key?: string;
  // ... other optional parameters
}

async function translateEpub(request: TranslationRequest): Promise&lt;Blob | {download_url: string}&gt; {
  const formData = new FormData();
  formData.append('file', request.file);
  formData.append('target_language', request.target_language);
  formData.append('model', request.model);

  if (request.openai_key) {
    formData.append('openai_key', request.openai_key);
  }

  const response = await fetch('/translate', {
    method: 'POST',
    body: formData
  });

  if (!response.ok) {
    const error = await response.json();
    throw new Error(error.message);
  }

  // Local mode returns file directly
  if (response.headers.get('content-type')?.includes('epub')) {
    return await response.blob();
  }

  // S3 mode returns JSON with download URL
  return await response.json();
}
</code></pre>
<h3 id="python">Python</h3>
<pre><code class="language-python">import requests
from typing import Union, Dict, Any

def translate_epub(
    file_path: str,
    target_language: str,
    model: str,
    api_key: str = None,
    base_url: str = &quot;http://localhost:8000&quot;
) -&gt; Union[bytes, Dict[str, Any]]:

    with open(file_path, 'rb') as f:
        files = {'file': f}
        data = {
            'target_language': target_language,
            'model': model
        }

        if api_key:
            data['openai_key'] = api_key

        response = requests.post(
            f&quot;{base_url}/translate&quot;,
            files=files,
            data=data
        )

    response.raise_for_status()

    # Check if response is binary (local mode)
    if response.headers.get('content-type', '').startswith('application/epub'):
        return response.content

    # JSON response (S3 mode)
    return response.json()
</code></pre>
<h3 id="curl-examples">cURL Examples</h3>
<p><strong>Basic Translation</strong>:</p>
<pre><code class="language-bash">curl -X POST &quot;http://localhost:8000/translate&quot; \
  -F &quot;file=@book.epub&quot; \
  -F &quot;target_language=zh-hans&quot; \
  -F &quot;model=chatgptapi&quot; \
  -F &quot;openai_key=sk-...&quot; \
  --output translated_book.epub
</code></pre>
<p><strong>With Advanced Options</strong>:</p>
<pre><code class="language-bash">curl -X POST &quot;http://localhost:8000/translate&quot; \
  -F &quot;file=@book.epub&quot; \
  -F &quot;target_language=zh-hans&quot; \
  -F &quot;model=chatgptapi&quot; \
  -F &quot;openai_key=sk-...&quot; \
  -F &quot;temperature=0.7&quot; \
  -F &quot;test=true&quot; \
  -F &quot;test_num=5&quot; \
  --output translated_book.epub
</code></pre>
<p><strong>Get Available Models</strong>:</p>
<pre><code class="language-bash">curl &quot;http://localhost:8000/models&quot; | jq .
</code></pre>
<p><strong>Health Check</strong>:</p>
<pre><code class="language-bash">curl &quot;http://localhost:8000/health&quot; | jq .
</code></pre>
<p>This comprehensive API documentation covers all the essential aspects needed for both frontend developers consuming the API and DevOps engineers deploying the service. The documentation includes practical examples, error handling strategies, and production-ready deployment configurations.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "content.code.copy"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>